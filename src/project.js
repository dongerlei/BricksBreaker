require=function a(s,l,c){function r(t,e){if(!l[t]){if(!s[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(h)return h(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var n=l[t]={exports:{}};s[t][0].call(n.exports,function(e){return r(s[t][1][e]||e)},n,n.exports,a,s,l,c)}return l[t].exports}for(var h="function"==typeof require&&require,e=0;e<c.length;e++)r(c[e]);return r}({AudioManager:[function(e,t,i){"use strict";cc._RF.push(t,"f4552WSbpFETpfiW9qGVqZS","AudioManager"),cc.Class({extends:cc.Component,properties:{bgmVolume:1,sfxVolume:1,bgmAudioID:-1,defaultMusicIndex:0},start:function(){},getUrl:function(e){return cc.url.raw("resources/"+e)},playMJBGM:function(e){this.playBGM("bgmusic/game_backmusic_0.mp3",0)},playBGM:function(e,t){var i=this.getUrl(e);-1!=this.bgmAudioID&&cc.audioEngine.stop(this.bgmAudioID),this.bgmAudioID=cc.audioEngine.play(i,!0,window.bgMusicvol),this.setBGMVolume(window.bgMusicvol)},stopBGM:function(){0<=this.bgmAudioID&&cc.audioEngine.stop(this.bgmAudioID)},playSFX:function(e){var t=this.getUrl(e);cc.audioEngine.play(t,!1,1)},setSFXVolume:function(e){console.log("setSFXVolume = "+e),this.sfxVolume,this.sfxVolume=e,window.bgFxvolRecord!=e&&(window.bgFxvol=e)},setBGMVolume:function(e){var t=0;t=0==cc.nab.audioManager.getBGMSetting().backGroundMusicVolume?0:"1"==window.voiceMode?window.bgMusicvolRealTime:e,cc.audioEngine.setVolume(this.bgmAudioID,t)},pauseAll:function(){cc.audioEngine.pauseAll()},resumeAll:function(){cc.audioEngine.resumeAll()},playGameEffectType:function(e){var t="";e==window.GameStageType.stage_1_box||e==window.GameStageType.stage_2_double_box||e==window.GameStageType.stage_3_box_left_down||e==window.GameStageType.stage_4_box_right_down||e==window.GameStageType.stage_5_box_right_up||e==window.GameStageType.stage_6_box_left_up||e==window.GameStageType.stage_11_box_type1||e==window.GameStageType.stage_12_box_type2||e==window.GameStageType.stage_13_box_type3||e==window.GameStageType.stage_16_box_type4||e==window.GameStageType.stage_17_box_type5||e==window.GameStageType.stage_20_box_type6?t="pfx/01.mp3":e==window.GameStageType.stage_7_line_hor||e==window.GameStageType.stage_8_line_ver?t="pfx/04.mp3":e==window.GameStageType.stage_7_line_hor||e==window.GameStageType.stage_9_line_bomb?t="pfx/03.mp3":e!=window.GameStageType.stage_21_ball_add1&&e!=window.GameStageType.stage_24_ball_fensan||(t="pfx/10.mp3"),""!=t&&this.playSFX(t)},playGameWinEffect:function(){this.playSFX("pfx/11.mp3")},playGameFailEffect:function(){this.playSFX("pfx/09.mp3")},playClickEffect:function(){this.playSFX("pfx/01.mp3")},playClickNpc:function(){this.playSFX("Npc/npc-stand.mp3")},playMjOperatorEffect:function(e,t){var i,o="women";1==t&&(o="man"),i="mjSounds/"+o+"/"+o+"_"+e+".mp3",this.playSFX(i)}}),cc._RF.pop()},{}],HallCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"7bbf7BzkcBOdJAvt0Pl3Y99","HallCtrl");var o,n=t("../ListView"),a=(o=n)&&o.__esModule?o:{default:o};var s=t("../ListAdapter");cc.Class({extends:cc.Component,properties:{contentView:{default:null,type:cc.Node},editView:{default:null,type:cc.Node},itemArr:cc.Prefab,listView:{default:null,type:a.default}},onLoad:function(){if(!cc.game.audioManager){var e=t("AudioManager");cc.audioManager=new e}},start:function(){for(var e=new s,t=[],i=0;i<600;i++)t[i]=5*i+1;e.setDataSet(t),this.listView.setAdapter(e)},clickItem:function(e,t){var i=e.target.getChildByName("label").getComponent(cc.Label).string;console.log("level = "+i),window.gameLevel=i,cc.director.loadScene("bounceGameAll"),cc.audioManager.playClickEffect()},clickEnterLevel:function(){var e=this.editView.getComponent(cc.EditBox).string;try{var t=parseInt(e);0<t&&t<3e3&&(window.gameLevel=t,cc.director.loadScene("bounceGameAll"),cc.audioManager.playClickEffect())}catch(e){console.log(e)}}}),cc._RF.pop()},{"../ListAdapter":"ListAdapter","../ListView":"ListView",AudioManager:"AudioManager"}],ListAdapter:[function(e,t,i){"use strict";cc._RF.push(t,"333a1MO2n1BLL+vQsw4n7S5","ListAdapter");var o=e("./ListView"),n=e("./ListItem");cc.Class({extends:o.AbsAdapter,updateView:function(e,t){var i=e.getComponent(n);i&&i.setData(this.getItem(t))}}),cc._RF.pop()},{"./ListItem":"ListItem","./ListView":"ListView"}],ListItem:[function(e,t,i){"use strict";cc._RF.push(t,"7d3b5Kyi7FFSIi04IUyLNgr","ListItem"),cc.Class({extends:cc.Component,properties:{label1:cc.Label,label2:cc.Label,label3:cc.Label,label4:cc.Label,label5:cc.Label},setData:function(e){this.label1.string=""+e,this.label2.string=""+(e+1),this.label3.string=""+(e+2),this.label4.string=""+(e+3),this.label5.string=""+(e+4)},onClick:function(e){var t=e.currentTarget.getChildByName("label").getComponent(cc.Label).string;try{var i=parseInt(t);0<i&&i<3e3&&(window.gameLevel=i,cc.director.loadScene("bounceGameAll"),cc.audioManager.playClickEffect())}catch(e){console.log(e)}}}),cc._RF.pop()},{}],ListView:[function(e,t,i){"use strict";cc._RF.push(t,"4f13ehoTphKMLFRAPTcTewB","ListView"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemTemplate=null,e.spacing=1,e.spawnCount=2,e.scrollView=null,e.content=null,e.adapter=null,e._items=new cc.NodePool,e._filledIds={},e.horizontal=!1,e._itemHeight=1,e._itemWidth=1,e._itemsVisible=1,e.lastStartIndex=-1,e.scrollTopNotifyed=!1,e.scrollBottomNotifyed=!1,e.pullDownCallback=null,e.pullUpCallback=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.scrollView?(this.content=this.scrollView.content,this.horizontal=this.scrollView.horizontal,this.horizontal?(this.scrollView.vertical=!1,this.content.anchorX=0,this.content.x=this.content.parent.width*this.content.parent.anchorX):(this.scrollView.vertical=!0,this.content.anchorY=1,this.content.y=this.content.parent.height*this.content.parent.anchorY)):console.error("ListView need a scrollView for showing.");var e=this._items.get()||cc.instantiate(this.itemTemplate);this._items.put(e),this._itemHeight=e.height||10,this._itemWidth=e.width||10,this.horizontal?this._itemsVisible=Math.ceil(this.content.parent.width/this._itemWidth):this._itemsVisible=Math.ceil(this.content.parent.height/this._itemHeight),console.log("可见区域的item数量为:",this._itemsVisible),this.adjustEvent()},e.prototype.setAdapter=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.adapter=t,null==this.adapter?console.warn("adapter 为空."):null==this.itemTemplate?console.error("Listview 未设置待显示的Item模板."):this.notifyUpdate(),[2]})})},e.prototype.getItemIndex=function(e){return Math.floor(Math.abs(e/(this._itemHeight+this.spacing)))},e.prototype.getPositionInView=function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.scrollView.node.convertToNodeSpaceAR(t)},e.prototype.notifyUpdate=function(e){var t=this;null!=this.adapter&&(e&&0<e.length?e.forEach(function(e){t._filledIds.hasOwnProperty(e)&&delete t._filledIds[e]}):Object.keys(this._filledIds).forEach(function(e){delete t._filledIds[e]}),this.lastStartIndex=-1,this.horizontal?this.content.width=this.adapter.getCount()*(this._itemWidth+this.spacing)+this.spacing:this.content.height=this.adapter.getCount()*(this._itemHeight+this.spacing)+this.spacing,this.scrollView.scrollToTop())},e.prototype.scrollToTop=function(e){void 0===e&&(e=!1),this.scrollView.scrollToTop(e?1:0)},e.prototype.scrollToBottom=function(e){void 0===e&&(e=!1),this.scrollView.scrollToBottom(e?1:0)},e.prototype.scrollToLeft=function(e){void 0===e&&(e=!1),this.scrollView.scrollToLeft(e?1:0)},e.prototype.scrollToRight=function(e){void 0===e&&(e=!1),this.scrollView.scrollToRight(e?1:0)},e.prototype.pullDown=function(e,t){this.pullDownCallback=e.bind(t)},e.prototype.pullUp=function(e,t){this.pullUpCallback=e.bind(t)},e.prototype.update=function(e){var t=this.checkNeedUpdate();0<=t&&this.updateView(t)},e.prototype._layoutVertical=function(e,t){this.content.addChild(e),e._tag=t,this._filledIds[t]=t,e.setPosition(0,-e.height*(.5+t)-this.spacing*(t+1))},e.prototype._layoutHorizontal=function(e,t){this.content.addChild(e),e._tag=t,this._filledIds[t]=t,e.setPosition(-e.width*(.5+t)-this.spacing*(t+1),0)},e.prototype.getRecycleItems=function(t,i){var o=this,e=this.content.children,n=[];return e.forEach(function(e){(e._tag<t||e._tag>i)&&(n.push(e),delete o._filledIds[e._tag])}),n},e.prototype.updateView=function(e){var t=this,i=e,o=i+this._itemsVisible+(this.spawnCount||2),n=this.adapter.getCount();if(!(n<=i)){n<o?(o=n,this.scrollBottomNotifyed||(this.notifyScrollToBottom(),this.scrollBottomNotifyed=!0)):this.scrollBottomNotifyed=!1,this.getRecycleItems(i-(this.spawnCount||2),o).forEach(function(e){t._items.put(e)});for(var a=0,s=this.findUpdateIndex(i,o);a<s.length;a++){var l=s[a],c=this.adapter._getView(this._items.get()||cc.instantiate(this.itemTemplate),l);this.horizontal?this._layoutHorizontal(c,l):this._layoutVertical(c,l)}}},e.prototype.checkNeedUpdate=function(){if(null==this.adapter)return-1;var e=this.horizontal?this.content.x-this.content.parent.width*this.content.parent.anchorX:this.content.y-this.content.parent.height*this.content.parent.anchorY,t=Math.floor(e/((this.horizontal?this._itemWidth:this._itemHeight)+this.spacing));return t<0&&!this.scrollTopNotifyed?(this.notifyScrollToTop(),this.scrollTopNotifyed=!0,t):(0<t&&(this.scrollTopNotifyed=!1),this.lastStartIndex!=t?this.lastStartIndex=t:-1)},e.prototype.findUpdateIndex=function(e,t){for(var i=[],o=e;o<t;o++)this._filledIds.hasOwnProperty(o)||i.push(o);return i},e.prototype.notifyScrollToTop=function(){!this.adapter||this.adapter.getCount()<=0||this.pullDownCallback&&this.pullDownCallback()},e.prototype.notifyScrollToBottom=function(){!this.adapter||this.adapter.getCount()<=0||this.pullUpCallback&&this.pullUpCallback()},e.prototype.adjustEvent=function(){var e=this;this.content.on(this.isMobile()?cc.Node.EventType.TOUCH_END:cc.Node.EventType.MOUSE_UP,function(){e.scrollTopNotifyed=!1,e.scrollBottomNotifyed=!1},this),this.content.on(this.isMobile()?cc.Node.EventType.TOUCH_CANCEL:cc.Node.EventType.MOUSE_LEAVE,function(){e.scrollTopNotifyed=!1,e.scrollBottomNotifyed=!1},this)},e.prototype.isMobile=function(){return cc.sys.isMobile||cc.sys.platform===cc.sys.WECHAT_GAME||cc.sys.platform===cc.sys.QQ_PLAY},__decorate([a(cc.Prefab)],e.prototype,"itemTemplate",void 0),__decorate([a],e.prototype,"spacing",void 0),__decorate([a],e.prototype,"spawnCount",void 0),__decorate([a(cc.ScrollView)],e.prototype,"scrollView",void 0),e=__decorate([n],e)}(cc.Component);i.default=s;var l=function(){function e(){this.dataSet=[]}return e.prototype.setDataSet=function(e){this.dataSet=e},e.prototype.getCount=function(){return this.dataSet.length},e.prototype.getItem=function(e){return this.dataSet[e]},e.prototype._getView=function(e,t){return this.updateView(e,t),e},e}();i.AbsAdapter=l,cc._RF.pop()},{}],boll:[function(e,t,i){"use strict";cc._RF.push(t,"46e33Lf/o1NJrSwDSrTdW6w","boll"),cc.Class({extends:cc.Component,properties:{},onBeginContact:function(e,t,i){if(cc.audioManager.playGameEffectType(i.node.name),this.isGetScoreNode(i.node)){var o=i.getComponent(cc.Sprite),n=i.node.getChildByName("scoreLabel").getComponent(cc.Label),a=parseInt(n.string);1==a?o.node.destroy():n.string=(--a).toString();var s=this.hslToRgb(.025*a,.5,.5);i.node.getChildByName("boxBgView").setColor(cc.color(s[0],s[1],s[2]))}else this.isLifeBall(i.node)&&(i.node.destroy(),t.node.game.addBolls++);t.node.game.playLineAni(i.node,t)},isGetScoreNode:function(e){return e.name==window.GameStageType.stage_1_box||e.name==window.GameStageType.stage_2_double_box||e.name==window.GameStageType.stage_3_box_left_down||e.name==window.GameStageType.stage_4_box_right_down||e.name==window.GameStageType.stage_5_box_right_up||e.name==window.GameStageType.stage_6_box_left_up||e.name==window.GameStageType.stage_11_box_type1||(e.name==window.GameStageType.stage_12_box_type2||e.name==window.GameStageType.stage_13_box_type3||e.name==window.GameStageType.stage_16_box_type4||e.name==window.GameStageType.stage_17_box_type5)&&0==e.getChildByName("imgclose").active},isLifeBall:function(e){return e.name==window.GameStageType.stage_21_ball_add1},hslToRgb:function(e,t,i){var o,n,a;if(0==t)o=n=a=i;else{var s=function(e,t,i){return i<0&&(i+=1),1<i&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e},l=i<.5?i*(1+t):i+t-i*t,c=2*i-l;o=s(c,l,e+1/3),n=s(c,l,e),a=s(c,l,e-1/3)}return[Math.round(255*o),Math.round(255*n),Math.round(255*a)]}}),cc._RF.pop()},{}],box:[function(e,t,i){"use strict";cc._RF.push(t,"64d28CtzUZHU6zwDKNtyRk2","box"),cc.Class({extends:cc.Component,properties:{boxtag:0},start:function(){}}),cc._RF.pop()},{}],gameCtr:[function(e,t,i){"use strict";var o;function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}cc._RF.push(t,"eadeeqNNm5NbLIvmWaMbYhD","gameCtr"),window.GameStageType=cc.Enum({stage_0_space:"0",stage_1_box:"1",stage_2_double_box:"2",stage_3_box_left_down:"3",stage_4_box_right_down:"4",stage_5_box_right_up:"5",stage_6_box_left_up:"6",stage_7_line_hor:"7",stage_8_line_ver:"8",stage_9_line_bomb:"9",stage_11_box_type1:"11",stage_12_box_type2:"12",stage_13_box_type3:"13",stage_16_box_type4:"16",stage_17_box_type5:"17",stage_20_box_type6:"20",stage_21_ball_add1:"21",stage_24_ball_fensan:"24",stage_100_ani_line_hor:"stage_horlineAni",stage_100_ani_line_ver:"stage_verlineAni",stage_100_ani_line_bomb:"stage_bomblineAni"});cc.Class((n(o={extends:cc.Component,properties:{bollDown:!1,isBegin:!1,isActivity:!1,isFirstBoll:!1,firstBollPositionX:0,tempFrstBollPositionX:0,allBolls:0,tampBolls:0,addBolls:0,level:1,ballPositonY:-314,topBoxY:380,boxWidth:58,boxHeight:58,indexBoll:{default:null,type:cc.Sprite},bollPrefab:{default:null,type:cc.Prefab},gameStagePrefabs:{default:[],type:cc.Prefab},lineBoxAni:{default:[],type:cc.Prefab},ground:{default:null,type:cc.Node},gameOverNode:{default:null,type:cc.Node},gamePauseNode:{default:null,type:cc.Node},ballLink:{default:null,type:cc.Sprite},levelLabel:{default:null,type:cc.Label},allBollsLabel:{default:null,type:cc.Label},numArray:[],typeArray:[],startNum:0,graphic_line:cc.Graphics,_cur_length:0,_ballDir:cc.Vec2},cleanGame:function(){this.isActivity=!1,this.firstBollPositionX=0,this.allBollsLabel.node.y=this.ballPositonY+30;for(var e=this.node.children,t=e.length;0<t;t--){var i=e[t];i&&((this.isCanDownNode(i)||this.isAllowDownNode(i))&&(i.removeFromParent(),i.destroy()),"bollSprite"==i.name&&(i.uuid==this.indexBoll.node.uuid?(this.indexBoll.node.setPosition(cc.v2(0,this.ballPositonY)),this.indexBoll.enabled=!0):(i.removeFromParent(),i.destroy())))}},analysisMapData:function(e){this.cleanGame(),this.numArray=[];for(var t=!(this.typeArray=[]),i=0;i<e.length;i++)if(-1==e[i].indexOf("data=")&&-1==e[i].indexOf("[layer]")&&-1==e[i].indexOf("type=Tile Layer 1"))if(-1!=e[i].indexOf("type=Tile Layer 2"))t=!0;else if(1==t){var o=e[i].split(",");this.numArray.push(o)}else{var n=e[i].split(",");this.typeArray.push(n)}this.isBegin=!0;for(var a=0,s=this.typeArray.length;0<=s&&12!=a;s--)a++,this.boxDownMove(!0),this.startNum=s,this.createCellBall(this.typeArray[s],this.numArray[s])},createCellBall:function(e,t){for(var i=0;i<11;i++)try{var o=e[i];if(!this.gameStagePrefabs[o])continue;var n=cc.instantiate(this.gameStagePrefabs[o]);n.setPosition(i*this.boxWidth-320+this.boxWidth/2,this.topBoxY),this.node.addChild(n),o!=window.GameStageType.stage_7_line_hor&&o!=window.GameStageType.stage_8_line_ver&&o!=window.GameStageType.stage_9_line_bomb||this.createStageLine(i,o);var a=n.getChildByName("scoreLabel");a&&(a.getComponent(cc.Label).string=t[i])}catch(e){}},boxDownMove:function(e){this.level++;var t=!1;if(1==this.isBegin){for(var i=!0,o=this.node.children,n=0;n<o.length;n++){var a=o[n];(this.isCanDownNode(a)||1==e&&this.isAllowDownNode(a))&&(i=!1,a.position.y<=this.topBoxY&&(a.y-=this.boxHeight,a.y<=this.ballPositonY&&(t=!0))),1!=e&&(a.name!=window.GameStageType.stage_16_box_type4&&a.name!=window.GameStageType.stage_17_box_type5||(a.getChildByName("imgclose").active=!a.getChildByName("imgclose").active))}this.bollDown=!1,t&&this.showGameOver(),i&&1!=e&&(window.gameLevel=window.gameLevel+1,this.readLevelConfig(),console.log("过关"),cc.audioManager.playGameWinEffect())}},isCanDownNode:function(e){return e.name==window.GameStageType.stage_1_box||e.name==window.GameStageType.stage_2_double_box||e.name==window.GameStageType.stage_3_box_left_down||e.name==window.GameStageType.stage_4_box_right_down||e.name==window.GameStageType.stage_5_box_right_up||e.name==window.GameStageType.stage_6_box_left_up||e.name==window.GameStageType.stage_7_line_hor||e.name==window.GameStageType.stage_8_line_ver||e.name==window.GameStageType.stage_9_line_bomb||e.name==window.GameStageType.stage_16_box_type4||e.name==window.GameStageType.stage_17_box_type5||e.name==window.GameStageType.stage_21_ball_add1||e.name==window.GameStageType.stage_24_ball_fensan||e.name==window.GameStageType.stage_100_ani_line_hor||e.name==window.GameStageType.stage_100_ani_line_bomb},isAllowDownNode:function(e){return e.name==window.GameStageType.stage_11_box_type1||e.name==window.GameStageType.stage_12_box_type2||e.name==window.GameStageType.stage_13_box_type3||e.name==window.GameStageType.stage_16_box_type4||e.name==window.GameStageType.stage_17_box_type5||e.name==window.GameStageType.stage_20_box_type6||e.name==window.GameStageType.stage_7_line_hor||e.name==window.GameStageType.stage_8_line_ver||e.name==window.GameStageType.stage_9_line_bomb||e.name==window.GameStageType.stage_16_box_type4||e.name==window.GameStageType.stage_17_box_type5||e.name==window.GameStageType.stage_21_ball_add1||e.name==window.GameStageType.stage_24_ball_fensan||e.name==window.GameStageType.stage_100_ani_line_hor||e.name==window.GameStageType.stage_100_ani_line_bomb},onLoad:function(){this.readLevelConfig(),cc.director.getPhysicsManager().enabled=!0,cc.director.getCollisionManager().enabled=!0,this.indexBoll.node.setPosition(cc.v2(this.firstBollPositionX,this.ballPositonY)),this.ballLink.node.setPosition(cc.v2(this.firstBollPositionX,this.ballPositonY)),this.ballLink.enabled=!1,(this.ground.getComponent("groundSprite").game=this).allBolls=30,this.allBollsLabel.getComponent(cc.Label).string="x"+this.allBolls,this.level=1,this.node.on(cc.Node.EventType.TOUCH_START,function(e){this.touchStart(e)}.bind(this),this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){this.touchMove(e)}.bind(this),this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){this.touchEnd(e)}.bind(this),this),this.graphic_line.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.graphic_line.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.graphic_line.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.graphic_line.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),cc.macro.ENABLE_WEBGL_ANTIALIAS=!0},drawRayCast:function(e,t){var i=900-this._cur_length;if(!(i<=0)){var o=e.add(t.mul(i)),n=cc.director.getPhysicsManager().rayCast(e,o,cc.RayCastType.AllClosest);if(0<n.length){for(var a=n[0],s=0;s<n.length;s++){var l=n[s];if(.001==l.collider.density){var c=l.point;this.drawAimLine(e,c);var r=c.sub(e).mag();this._cur_length+=r;var h=l.normal,d=t,p=d.sub(h.mul(2*d.dot(h)));this.drawRayCast(c,p)}}a.collider.sensor}else this.drawAimLine(e,o)}},drawAimLine:function(e,t){var i=this.graphic_line.node.convertToNodeSpaceAR(e);this.graphic_line.moveTo(i.x,i.y);var o=t.sub(e),n=Math.round(o.mag()/20);o.normalizeSelf().mulSelf(20);for(var a=0;a<n;a++)i.addSelf(o),this.graphic_line.circle(i.x,i.y,2)},readLevelConfig:function(){var o=this;this.levelLabel.getComponent(cc.Label).string="Level "+window.gameLevel,cc.loader.loadRes("map/mapdata"+window.gameLevel,function(e,t){var i=t.split("\n");o.analysisMapData(i),console.log("1")})},createStageLine:function(e,t){if(t==window.GameStageType.stage_7_line_hor)t=0;else{if(t!=window.GameStageType.stage_8_line_ver)return;t=1}var i=cc.instantiate(this.lineBoxAni[t]),o=0,n=0;0==t?(o=0,n=this.topBoxY):1==t&&(o=e*this.boxWidth-320+this.boxWidth/2,n=80),i.x=o,i.y=n,this.node.addChild(i)},randomLine:function(e,t){if(e.name==window.GameStageType.stage_24_ball_fensan){this.randomFrom(0,2);2;var i=t.body.linearVelocity.x,o=t.body.linearVelocity.y;i<0&&(i=-i),o<0&&(o=-o);var n=i+o,a=0,s=0;s=a=n/2,t.body.linearVelocity=cc.v2(a,s)}},playLineAni:function(e,t){if(this.randomLine(e,t),e.name==window.GameStageType.stage_7_line_hor||e.name==window.GameStageType.stage_8_line_ver||e.name==window.GameStageType.stage_9_line_bomb){var i="";e.name==window.GameStageType.stage_7_line_hor?i=window.GameStageType.stage_100_ani_line_hor:e.name==window.GameStageType.stage_8_line_ver?i=window.GameStageType.stage_100_ani_line_ver:e.name==window.GameStageType.stage_9_line_bomb&&(i=window.GameStageType.stage_100_ani_line_bomb);for(var o=this.node.children,n=0;n<o.length;n++){var a=o[n];if(a.y==e.y&&a.name==i)a.getComponent("lineBoxAni").runAnimation();else if(a.x==e.x&&a.name==i){a.getComponent("lineBoxAni").runAnimation()}a.y==e.y&&i==window.GameStageType.stage_100_ani_line_hor&&this.reduceOneBox(a),a.x==e.x&&i==window.GameStageType.stage_100_ani_line_ver&&this.reduceOneBox(a),a.y==e.y&&i==window.GameStageType.stage_100_ani_line_bomb&&this.reduceBox(a)}}},reduceOneBox:function(e){var t=e.getChildByName("scoreLabel");if(t){var i=t.getComponent(cc.Label),o=parseInt(i.string);1==o?e.destroy():i.string=(--o).toString();this.hslToRgb(.025*o,.5,.5)}},reduceBox:function(e){e&&e.destroy()},touchStart:function(e){if(this.ballLink.node.setPosition(cc.v2(this.firstBollPositionX,this.ballPositonY)),0==this.isActivity){var t=this.indexBoll.node.convertToNodeSpace(e.touch._point),i=Math.abs(t.x),o=Math.abs(t.y)/i,n=180*Math.atan(o)/3.14;n<5&&(n=5),t.x<0?this.ballLink.node.setRotation(-(90-n)):this.ballLink.node.setRotation(90-n),this.graphic_line.clear()}},touchMove:function(e){if(0==this.isActivity){this.ballLink.enabled=!0;var t=this.indexBoll.node.convertToNodeSpace(e.touch._point),i=Math.abs(t.x),o=Math.abs(t.y)/i;(l=180*Math.atan(o)/3.14)<5&&(l=5),t.x<0?this.ballLink.node.setRotation(-(90-l)):this.ballLink.node.setRotation(90-l),this.graphic_line.clear(),this._cur_length=0;var n=new cc.Vec2(this.indexBoll.node._position.x,this.indexBoll.node._position.y);n=this.node.convertToWorldSpaceAR(n);var a=e.touch.getLocation(),s=new cc.Vec2(a.x-n.x,a.y-n.y).normalizeSelf(),l=(i=Math.abs(s.x),o=Math.abs(s.y)/i,180*Math.atan(o)/3.14);if(console.log("angle = "+l),l<5)return void(this._ballDir=new cc.Vec2(0,0));if(s.y<=0)return;this._ballDir=s,this.drawRayCast(n,s),this.graphic_line.stroke()}},touchEnd:function(e){if(0==this.isActivity){if(0==this._ballDir.x&&0==this._ballDir.y)return;if(this._ballDir.y<=0)return;this.ballLink.enabled=!1,this.allBollsLabel.enabled=!1,0==this.isBegin&&(this.isBegin=!0),this.tempFrstBollPositionX=this.firstBollPositionX,this.schedule(this.bollStartRun,.04,this.allBolls-1),this.isFirstBoll=!1,this.indexBoll.enabled=!1,this.isActivity=!0,this.graphic_line.clear()}},bollStartRun:function(){var e=cc.instantiate(this.bollPrefab);this.node.addChild(e),e.game=this,e.setPosition(cc.v2(this.tempFrstBollPositionX,this.ballPositonY));var t=e.getComponent(cc.RigidBody),i=-this.ballLink.node.rotation-270,o=Math.cos(.017453293*i),n=Math.sin(.017453293*i);o=100*this._ballDir.x*12*1.2,n=100*this._ballDir.y*12*1.2,t.linearVelocity=cc.v2(o,n),console.log("this._ballDir.x = "+this._ballDir.x+" this._ballDir.y = "+this._ballDir.y)},showTishiLine:function(){this.ballLink.enabled=!0},showGameOver:function(){console.log("游戏结束"),cc.audioManager.playGameFailEffect()},update:function(e){1==this.bollDown&&(this.boxDownMove(),this.startNum--,0<=this.startNum&&this.createCellBall(this.typeArray[this.startNum],this.numArray[this.startNum])),1==this.isFirstBoll&&(this.indexBoll.enabled=!0,this.indexBoll.node.setPosition(cc.v2(this.firstBollPositionX,this.ballPositonY)))}},"showGameOver",function(){this.gameOverNode.active=!0}),n(o,"showGamePause",function(){this.gamePauseNode.active=!0}),n(o,"clickBtnContinue",function(){this.gamePauseNode.active=!1,this.gameOverNode.active=!1}),n(o,"clickBtnRestart",function(){this.unschedule(this.bollStartRun),this.readLevelConfig(),this.gamePauseNode.active=!1}),n(o,"clickBtnBack",function(){cc.director.loadScene("hall")}),n(o,"hslToRgb",function(e,t,i){var o,n,a;if(0==t)o=n=a=i;else{var s=function(e,t,i){return i<0&&(i+=1),1<i&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e},l=i<.5?i*(1+t):i+t-i*t,c=2*i-l;o=s(c,l,e+1/3),n=s(c,l,e),a=s(c,l,e-1/3)}return[Math.round(255*o),Math.round(255*n),Math.round(255*a)]}),n(o,"randomFrom",function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}),o)),cc._RF.pop()},{}],groundSprite:[function(e,t,i){"use strict";cc._RF.push(t,"7061e552B9BQZZm3GGw6d+3","groundSprite"),cc.Class({extends:cc.Component,properties:{isTouchBoll:!1,game:{default:null,serializable:!1}},onLoad:function(){},onBeginContact:function(e,t,i){"bollSprite"==i.node.name&&(i.node.destroy(),0==this.isTouchBoll&&(this.game.firstBollPositionX=i.node.x,this.isTouchBoll=!0,this.game.isFirstBoll=!0),this.game.tampBolls++,this.game.tampBolls==this.game.allBolls&&(this.game.allBolls+=this.game.addBolls,this.game.addBolls=0,this.game.bollDown=!0,this.game.tampBolls=0,this.isTouchBoll=!1,this.game.isActivity=!1,this.game.allBollsLabel.enabled=!0,this.game.allBollsLabel.getComponent(cc.Label).string="x "+this.game.allBolls,this.game.allBollsLabel.node.x=this.game.firstBollPositionX))},start:function(){}}),cc._RF.pop()},{}],lifeBox:[function(e,t,i){"use strict";cc._RF.push(t,"6700apouQpBKYVEhPCOXU/q","lifeBox"),cc.Class({extends:cc.Component,properties:{},onBeginContact:function(e,t,i){"bollSprite"==i.node.name&&t.node.destroy()}}),cc._RF.pop()},{}],lineBoxAni:[function(e,t,i){"use strict";cc._RF.push(t,"45ad6lK5IdHi6Yq9V07lAM9","lineBoxAni"),cc.Class({extends:cc.Component,properties:{_anum:0},onLoad:function(){this.node.active=!1},onEnable:function(){},runAnimation:function(){this.node.active=!0;var e=cc.sequence(cc.scaleTo(.1,1,0),cc.scaleTo(.1,1,1)),t=cc.repeat(e,5);this.node.runAction(t);var i=cc.sequence(cc.fadeIn(.1),cc.fadeOut(.1)),o=cc.repeat(i,2);this.node.runAction(o)},start:function(){},update:function(e){}}),cc._RF.pop()},{}]},{},["AudioManager","ListAdapter","ListItem","ListView","boll","box","HallCtrl","gameCtr","groundSprite","lifeBox","lineBoxAni"]);